'use strict';define(["require","modules/default/defaultview","src/util/util","threejs","src/util/debug","lib/parser/Parser","lib/threejs/TrackballControls"],function(a,b,c,d,e,f){"use strict";function g(){}return $.extend(!0,g.prototype,b,{init:function(){var a=this;this.webgl=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return!1}}();var b=this.module.getConfiguration;this._id=c.getNextUniqueId();var d=$("<div>",{Id:this._id});d.css("display","table").css("height","100%").css("width","100%").css("overflow","hidden"),this.dom=d,this.module.getDomContent().html(this.dom).css("overflow","hidden"),this.zFunctionText=b("function")||"sin(sqrt(0.01*x^2  + 0.01*y^2))*10",this.xMin=b("xMin")||-100,this.xMax=b("xMax")||100,this.yMin=b("yMin")||-100,this.yMax=b("yMax")||100,this.zMin=b("zMin")||-100,this.zMax=b("zMax")||100,this.xRange=this.xMax-this.xMin,this.yRange=this.yMax-this.yMin,this.clearScene(),this.createGraph(),this.resolveReady(),this.doAnimation=!1,this.dom.on("mouseenter",function(){a.doAnimation=!0}),this.dom.on("mouseleave",function(){a.doAnimation=!1})},clearScene:function(){this.scene&&(this.scene.remove(this.graphGeometry),this.scene.remove(this.graphMesh),this.scene.remove(this.floor),delete this.graphGeometry,delete this.graphMesh,delete this.floor)},blank:{function:function(){this.clearScene()}},onResize:function(){if(!this.webgl)return void e.warn("webgl context does not exist");var b=this;this.module.viewReady.then(function(){var c=b.module.getConfiguration,e=c("segments");b.graphMesh&&b.scene.remove(b.graphMesh);var f=d.ImageUtils.loadTexture(a.toUrl("./square.png"));f.wrapS=f.wrapT=d.RepeatWrapping,f.repeat.set(40,40);var g=new d.MeshBasicMaterial({map:f,vertexColors:d.VertexColors,side:d.DoubleSide});b.graphMesh=new d.Mesh(b.graphGeometry,g),b.graphMesh.doubleSided=!0,b.scene.add(b.graphMesh),b.renderer.setSize(b.width,b.height),b.setCamera(),b.setControls(),b.firstAnimation=60,b.animate()})},addFloor:function(a){var b=new d.MeshBasicMaterial({color:136,wireframe:!0,side:d.DoubleSide}),c=new d.PlaneBufferGeometry(1e3,1e3,10,10);this.floor=new d.Mesh(c,b),a.add(this.floor)},update:{function:function(a){this.zFunctionText=a.get(),this.createGraph(),this.onResize()}},animate:function(){var a=this;requestAnimationFrame(a.animate.bind(a)),(a.doAnimation||0<a.firstAnimation)&&(0<a.firstAnimation&&a.firstAnimation--,a.renderer.render(a.scene,a.camera),a.controls.update())},setCamera:function(){var a=this.width/this.height;this.camera=new d.PerspectiveCamera(45,a,.1,2e4),this.camera.position.set(2*this.xMax,.5*this.yMax,4*this.zMax),this.camera.up=new d.Vector3(0,0,1),this.camera.lookAt(this.scene.position),this.scene.add(this.camera)},setControls:function(){this.controls=new d.TrackballControls(this.camera,this.renderer.domElement)},createGraph:function(){var a=this,b=a.module.getConfiguration,c=b("segments"),e=f.parse(a.zFunctionText).toJSFunction(["x","y"]),g=new d.ParametricGeometry(function(b,c){b=a.xRange*b+a.xMin,c=a.yRange*c+a.yMin;var f=e(b,c);return isNaN(f)?new d.Vector3(0,0,0):new d.Vector3(b,c,f)},c,c,!0);g.computeBoundingBox(),a.zMin=g.boundingBox.min.z,a.zMax=g.boundingBox.max.z,a.zRange=a.zMax-a.zMin;for(var h,k,l,m,n,o=["a","b","c","d"],p=0;p<g.vertices.length;p++)k=g.vertices[p],h=new d.Color(255),h.setHSL(.7*(a.zMax-k.z)/a.zRange,1,.5),g.colors[p]=h;for(var p=0;p<g.faces.length;p++){l=g.faces[p],m=l instanceof d.Face3?3:4;for(var q=0;q<m;q++)n=l[o[q]],l.vertexColors[q]=g.colors[n]}a.graphGeometry=g,a.scene=new d.Scene,a.renderer||(a.renderer=a.webgl?new d.WebGLRenderer({antialias:!0}):new d.CanvasRenderer,a.renderer.setClearColor(15658734,1)),a.dom.append(a.renderer.domElement),a.addFloor(a.scene)}}),g});
