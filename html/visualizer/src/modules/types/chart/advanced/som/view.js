'use strict';define(["jquery","modules/default/defaultview","jsgraph","src/util/color","chroma"],function(a,b,c,d,e){"use strict";function f(){}function g(a,b,c,d,f,g,i){var j,k,l=e(c),m=e(d);if("fixed"===a)return k=l.css(),function(){return k};if("range"===a)return j=e.scale([l,m]).mode(b),function(a){return j(a[f]).css()};if("inter"===a){var n=h(c,d),o=(c[3]+d[3])/2;return function(a){return e([n[0](a[f]),n[1](a[g]),n[2](a[i]),o]).css()}}}function h(a,b){return[i(a[0],b[0]),i(a[1],b[1]),i(a[2],b[2])]}function i(c,d){return c=+c,d=+d,function(a){return c*(1-a)+d*a}}return a.extend(!0,f.prototype,b,{init(){this.dom=document.createElement("div"),this.dom.style.height="100%",this.dom.style.width="100%",this.dom.style.overflow="hidden",this.module.getDomContent().html(this.dom),this.series={},this.datasetInfo={}},inDom(){var a={primaryGrid:!1,secondaryGrid:!1};this.graph=new c(this.dom,{close:{left:!1,right:!1,top:!1,bottom:!1},plugins:{zoom:{zoomMode:"xy"},drag:{}},pluginAction:{zoom:{shift:!1,ctrl:!1},drag:{shift:!0,ctrl:!1}},dblclick:{type:"plugin",plugin:"zoom",options:{mode:"total"}}},{bottom:[a],left:[a]});var b=this;this.graph.on("shapeMouseOver",function(a){b.module.controller.onCellHover(a.getData())}),this.graph.getXAxis().hide().setAxisDataSpacing(0,0),this.graph.getYAxis().hide().setAxisDataSpacing(0,0),this.resolveReady()},blank:{model(){this.graph.removeShapes()},dataset(a){this.series[a]&&(this.series[a].kill(),delete this.series[a]),this.datasetInfo[a]&&(this.datasetInfo[a]=null)}},update:{model(a){if("SOM"===a.get("name")+""){var b,c=a.get("data"),d=c.length,e=c[0].length,f=this.graph,h=this.module.getConfiguration,k=h("bgField1"),l=h("bgField2"),m=h("bgField3"),n=a.options.fields;if(Array.isArray(n))for(b=0;b<n.length;b++)n[b].name===k&&(k=b),n[b].name===l&&(l=b),n[b].name===m&&(m=b);const i=g(h("bgType"),h("bgSpace"),h("bgColor1"),h("bgColor2"),k,l,m);for(f.getXAxis().forceMin(0).forceMax(d),f.getYAxis().forceMin(0).forceMax(e),b=0;b<d;b++)for(var o,p=0;p<e;p++)o=f.newShape("rect",{position:[{x:b,y:p},{x:b+1,y:p+1}],fillColor:i(c[b][p]),layer:1,info:c[b][p]}),o.draw(),o.redraw();this.redraw()}},dataset(a,b){var c,d,f,h=this.module.getConfiguration("datasets");if(h)for(c=0;c<h.length;c++)if(h[c].groups.group[0].dataset[0]===b){f=h[c].groups.group[0];break}if(!f)d=g("fixed",null,[255,0,0,1]);else switch(f.colorType[0]){case"fixed":d=g("fixed",null,f.color1[0]);break;case"jpath":d=function(a){return e(DataObject.check(a).getChildSync(f.jpath1[0])+"").css()};}var j,k=this,m=a.getChildSync(["data","0"]),n=m.x.length,l=Array(2*n),o=Array(n);for(c=0;c<n;c++)l[2*c]=m.x[c],l[2*c+1]=m.y[c],j=d(m.info[c]),o[c]={fill:j};var p=this.series[b]=this.graph.newSerie(b,{layer:2},"scatter").autoAxis().setData(l).setStyle({shape:"circle",r:3,stroke:"black"},o).setStyle({r:6},"selected");m.info&&(p.on("mouseover",function(a){p.selectPoint(a),k.module.controller.onElementHover(m.x[a],m.y[a],m.info[a])}),p.on("mouseout",function(a){p.selectPoint(a,!1)})),this.redraw()}},onResize(a,b){this.graph&&(this.graph.resize(a,b),this.redraw())},redraw(){this.graph.redraw(),this.graph.autoscaleAxes(),this.graph.drawSeries()}}),f});
