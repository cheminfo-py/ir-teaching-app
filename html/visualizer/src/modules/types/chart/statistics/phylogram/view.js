'use strict';define(["modules/default/defaultview","src/util/util","lib/d3/d3.phylogram","src/util/api","src/util/ui","src/util/tree"],function(a,b,c,d,e,f){"use strict";function g(){}function h(a,b,c){Array.isArray(c)&&(a[b]=c)}return $.extend(!0,g.prototype,a,{init:function(){this._id=b.getNextUniqueId(),this.selectorId=`#${this._id}`,this.chart=null,this.currentHighlightId=null,this.dom=e.getSafeElement("div").attr("id",this._id),this.module.getDomContent().html(this.dom),this.resolveReady()},blank:function(){this.dom.empty()},getIdHash:function(a){if(a.id&&(this._idHash[a.id]=a),Array.isArray(a.children))for(var b=0;b<a.children.length;b++)this.getIdHash(a.children[b])},update:{tree:function(a){this._value=a.get(),this.updateTree()},newTree:function(a){this._tree=a.get(),this.doAnnotation()},data:function(a){this._data=a.get(),this.doAnnotation()}},doAnnotation:function(){if(this._tree){var a=this.getOptions();this._value=f.annotateTree(this._tree,this._data||[],a),this.updateTree()}},updateTree:function(){this._idHash=[],this.getIdHash(this._value),d.killHighlight(this._id),this.drawPhylogram()},getOptions:function(){var a={},b=this.module.getConfiguration;return h(a,"$color",b("jpathColor")),h(a,"label",b("jpathLabel")),a},drawPhylogram:function(){if(this._value){var a=this._value,b=this;this.dom.empty();var e=this.module.getConfigurationCheckbox("d3check","skipBranchLengthScaling");c.phylogram.build(this.selectorId,a,{height:b.height,width:b.width,skipBranchLengthScaling:e,skipTicks:!1,skipLabels:this.module.getConfigurationCheckbox("d3check","skipLabels"),labelDx:this.module.getConfiguration("labelDx"),labelDy:this.module.getConfiguration("labelDy"),labelSize:this.module.getConfiguration("labelSize"),children:function(a){return a.children},callbackMouseOverLeaf:function(a){b.module.controller.mouseOverLeaf(a),d.highlight(a.data,1)},callbackMouseOutLeaf:function(a){b.module.controller.mouseOutLeaf(a),d.highlight(a.data,0)},callbackClickLeaf:function(a){b.module.controller.clickLeaf(a)},callbackMouseOverBranch:function(a){b.module.controller.mouseOverBranch(a.target)},callbackMouseOutBranch:function(a){b.module.controller.mouseOutBranch(a.target)},callbackClickBranch:function(a){b.module.controller.clickBranch(a.target)}});var f=c.selectAll(`${this.selectorId} .leaf`);f.each(function(a){(function(a,c){a.data&&a.data._highlight&&d.listenHighlight(a.data,function(b){var d=c.select("circle");d.attr("fill",function(c){return c.data&&c.data.$color?c.data.$color:b?"#f5f48d":"grey"}),d.attr("r",b?9:4.5)},!1,b._id)})(a,c.select(this))}),c.selectAll(`${this.selectorId} .link`).each(function(){c.select(this).attr("stroke-width",`${b.module.getConfiguration("branchWidth")}px`||"5px")})}},onResize:function(){this.drawPhylogram()}}),g});
