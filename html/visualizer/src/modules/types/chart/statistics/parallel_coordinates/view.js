'use strict';define(["modules/default/defaultview","src/util/util","src/util/datatraversing","src/util/context","lib/d3/d3.parcoords","src/util/api","src/util/ui","lodash"],function(a,b,c,d,e,f,g,h){"use strict";function i(){this._id=b.getNextUniqueId(),this._value=new DataArray,this._addedColumns={},this._currentColumns={},this._previousColumns=[]}return b.loadCss("lib/d3/d3.parcoords.css"),$.extend(!0,i.prototype,a,{inDom:function(){this.dom=g.getSafeElement("div").attr({id:this._id,class:"parcoords"});var a=this;d.listen(this.dom[0],[["<li><a><span class=\"ui-icon ui-icon-refresh\"></span>Reset selection</a></li>",function(){a.resetBrush()}]]),this.jpathConfig=$.extend(!0,[],this.module.getConfiguration("colsjPaths")),this.preventHighlight=this.module.getConfigurationCheckbox("options","hide"),this.module.getDomContent().html(this.dom),this.resolveReady()},blank:{value:function(){this.dom&&this.dom.empty()},columns:function(){for(var a=0;a<this._previousColumns.length;a++)delete this._currentColumns[this._previousColumns[a].name];this._previousColumns=[]}},update:{value:function(a){a?(a=a.get(),this._value=a.length?a.resurrect():[]):this._value=[],this.redrawChart()},columns:function(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)this._currentColumns[a[b].name]=a[b];this._previousColumns=a,this.redrawChart()}}},onActionReceive:{addColumn:function(a){a&&a.name&&a.jpath&&(this._addedColumns[a.name]=a,this.redrawChart())},removeColumn:function(a){a&&a.name&&(delete this._addedColumns[a.name],this.redrawChart())}},onResize:function(){this.dom.css("width",this.width-2),this.redrawChart()},redrawChart:function(){function a(a){b.module.controller.onBrushSelection(a)}var b=this;if(this.createIntermediateData(),this.dom.empty(),this._data&&0<this._data.length){var c=this.module.getConfiguration,d=this.module.getConfigurationCheckbox,f=this.parcoords=e.parcoords()(`#${this._id}`);f.data(this._data),f.detectDimensions(),this._names&&f.dimensions(this._names),this._color&&f.color(this._color),1e3<this._data.length&&(f.mode("queue"),f.rate(200)),f.render();var g=c("brushMode");f.brushMode(g),"None"!=g&&f.brushPredicate(c("brushPredicate")),d("options","reorder")&&f.reorderable(),d("options","shadow")&&f.shadows(),d("options","brush")||f.on("brush",a),f.on("brushend",a),this._parcoords=f}else this.dom.html("No column to display");this.module.controller.onBrushSelection(this._data)},createIntermediateData:function(){var a=this.getColumns(),c=a.length,d=this.module.getConfiguration("colorjpath"),e=this;d&&(d=b.makejPathFunction(d),this._color=function(a){return a.__color?a.__color:"#000"});var g=this._value,h=g.length;if(f.killHighlight(this.module.getId()),this._highlighted=[],!h)return void(this._data=[]);var k,l=Array(h),m=Array(c);for(k=0;k<c;k++)m[k]=a[k].name.toString();this._names=m;var n,o;for(let b=0;b<h;b++){n={},o=g[b],l[b]=n,f.listenHighlight(o,function(a){a?e._highlighted.push(e._data[b]):e._highlighted.splice(e._highlighted.indexOf(e._data[b],1)),e.updateHighlight()},!1,e.module.getId());for(var p,q=0;q<c;q++)p=a[q].jpathF(o),n[a[q].name]=p?p.valueOf():p;d&&(n.__color=d(o)||"#000000"),n.__id=b}this._data=l},getColumns:function(){var a,c=[],d={},e=this.jpathConfig;if(e)for(a=0;a<e.length;a++)e[a].jpath&&(d[e[a].name]=$.extend(!0,{},e[a]));for(a in $.extend(d,this._currentColumns,this._addedColumns),d)c.push(d[a]);for(a=0;a<c.length;a++)"function"!=typeof c[a].jpathF&&Object.defineProperty(c[a],"jpathF",{value:b.makejPathFunction(c[a].jpath)});return c},resetBrush:function(){this._parcoords&&(this._parcoords.brushReset(),this.module.controller.onBrushSelection(this._data))},updateHighlight:h.throttle(function(){var a=this._highlighted;if(this.preventHighlight){a=[];for(var b=this.parcoords.brushed(),c=0,d=this._highlighted.length;c<d;c++)-1<b.indexOf(this._highlighted[c])&&a.push(this._highlighted[c])}a.length?this.parcoords.highlight(a):this.parcoords.unhighlight()},20)}),i});
