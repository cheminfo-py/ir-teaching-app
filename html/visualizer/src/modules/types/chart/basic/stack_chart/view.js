'use strict';define(["modules/default/defaultview","src/util/datatraversing","src/util/api","src/util/util","lib/flot/jquery.flot"],function(a,b,c,d){"use strict";function e(){}return $.extend(!0,e.prototype,a,{init:function(){this.dom&&this.dom.empty(),this.dom||(this._id=d.getNextUniqueId(),this.dom=$(`<p id="choices${this._id}" style="float:right; width:15%;"><br></p><div style="height: 100%;width: 80%" id="${this._id}"></div>`),this.module.getDomContent().html(this.dom)),this._flot&&delete this._flot,this.loadedData=$.Deferred(),this._data=[];var a,b,c=this.module.getConfiguration;this.updateOptions(c,a,b),this.resolveReady()},onResize:function(){var a=this;this.loadedData.done(function(){this._plot=a.plot(a._id,a._data,a._options);var b=$(`#choices${a._id}`);b.empty(),$.each(a._data,function(a,c){b.append(`<br/><input type='checkbox' name='${a}' checked='checked' id='id${a}'></input>`+`<label for='id${a}'>${c.label}</label>`)}),b.find("input").bind("click",function(){a.plotAccordingToChoices(b,a._id)})})},update:{chart:function(a){var b=this.module.getConfiguration;this._convertChartToData(a.get().data);var c=a.get().axis,d=a.get().data[0].x;this.updateOptions(b,c,d),this._plot=this.plot(this._id,this._data,this._options),this.loadedData.resolve()}},_convertChartToData:function(a){if(this._data=[],Array.isArray(a)&&a&&Array.isArray(a.x))for(var b=0;b<a.length;b++){for(var c=a[b].x,d=a[b].y,e=a[b]._highlight,f=a[b].serieLabel,g=a[b].info[0].name,h=[],k=0;k<d.length;k++)$.isNumeric(c[k])?h.push({0:c[k],1:d[k],_highlight:e[k]}):h.push({0:k,1:d[k],_highlight:e[k]});this._data[b]={data:h,info:f,label:g}}},updateOptions:function(a,b,c){var d=null,e=null,f=null,g=null,h=null,j=null,k=null,l=null;if(null!=b){if(d=b[0].type,e=b[1].type,h=b[0].max,j=b[1].max,f=b[0].min,g=b[1].min,Array.isArray(c)){for(var m=[],n=0;n<c.length;n++)m.push([n,c[n]]);k=m}if(Array.isArray(b[1].unit)){for(m=[],n=0;n<b[1].unit.length;n++)m.push([n,b[1].unit[n]]);l=m}}var o=!1,p=!1,q=!1,r=a("stack"),s=a("barWidth"),t=a("xLabel"),v=a("yLabel"),w=a("xLabelHeight"),x=a("xLabelWidth"),y=a("yLabelHeight"),z=a("yLabelWidth");switch(a("preference")){case"Lines With Steps":o=!0,q=!0;break;case"Bars":p=!0;break;case"Lines":q=!0;}this._options={xaxis:{show:!0,position:d,min:f,max:h,tickFormatter:function(a,b){return a<b.max?a.toFixed(2):t},ticks:k,labelWidth:x,labelHeight:w},yaxis:{position:e,min:g,max:j,ticks:l,tickFormatter:function(a,b){return a<b.max?a.toFixed(2):v},labelWidth:z,labelHeight:y},grid:{clickable:!0,hoverable:!0},series:{stack:r,lines:{show:q,fill:a("fill"),steps:o},bars:{show:p,barWidth:s}}}},plot:function(a,b,c){var d=this;this._plot=$.plot(`#${a}`,b,c),$(`#${a}`).bind("plotclick",function(a){a.preventDefault()}),$(`#${a}`).bind("plothover",function(a,b,c){c?d.module.controller.elementHover(d._data[c.seriesIndex].data[c.dataIndex]):d.module.controller.elementOut()})},plotAccordingToChoices:function(a,b){var c=this,d=[];a.find("input:checked").each(function(){var a=$(this).attr("name");a&&c._data[a]&&d.push(c._data[a])}),0<d.length&&this.plot(b,d,c._options)}}),e});
