'use strict';define(["jquery","modules/default/defaultview","src/util/ui"],function(a,b,c){"use strict";function d(){}return a.extend(!0,d.prototype,b,{init:function(){var b=this,d=this.module.getConfiguration;this.dom=a("<div></div>"),this.search=a("<table class=\"Search\" cellpadding=\"5\" cellspacing=\"0\"><col width=\"100\"><col width=\"*\"></table>").css("width","90%"),this.dom.append(this.search),this.$feedback=a("<div id=\"ci-webservice-search-feedback\"/>"),this.dom.append(this.$feedback),this.module.getDomContent().html(this.dom),this.oldVal={},this._url=!1;var e;if(e=d("searchparams")){for(var f in e)f&&e[f].label&&this.search.append(`<tr><td><nobr>${e[f].label}</nobr></td><td>${this._makeFormEl(e[f],f)}</td></tr>`);d("url");this.button=d("button",!1),this.button&&require(["forms/button"],function(a){b.dom.append((b.buttonInst=new a(d("buttonlabel")||"Search",function(){var a=Promise.resolve(!0);b.module.getConfigurationCheckbox("askConfirm","yes")&&(a=c.confirm(b.module.getConfiguration("confirmText"))),a.then(function(a){a&&b.module.controller.doSearch()})})).render())}),this.search.on("keyup","input[type=text], textarea",function(c){var d=a(this),e=d.val();"float"===d.attr("data-type")&&(e=parseFloat(e));var f=d.attr("name");return b.oldVal[f]&&b.oldVal[f]===e||d.trigger("change"),void 0!==f&&b.module.controller.addValue({name:f,destination:d.attr("data-dest")},e),b.button?void(b.buttonInst&&13==c.keyCode&&b.module.controller.doSearch()):void b.module.controller.doSearch()}),this.search.on("change","select",function(){var c=a(this),d=c.val();"float"===c.attr("data-type")&&(d=parseFloat(d));var e=c.attr("name");void 0!==e&&b.module.controller.addValue({name:e,destination:c.attr("data-dest")},d),b.button||b.module.controller.doSearch()}),this.search.on("change","input[type=checkbox]",function(){var c=a(this),d=c.is(":checked"),e=c.attr("name");void 0!==e&&b.module.controller.addValue({name:e,destination:c.attr("data-dest")},d),b.button||b.module.controller.doSearch()})}this.resolveReady()},_makeFormEl:function(a){var b=`name="${a.name}" data-dest="${a.destination}" data-type="${a.fieldtype}"`;switch(a.fieldtype){case"combo":var c,d=(a.fieldoptions||"").split(";"),e="";e+=`<option ${""==a.defaultvalue?"selected=\"selected\" ":""}value=""></option>`;for(var f=0,g=d.length;f<g;f++)c=d[f].split(":"),e+=`<option ${a.defaultvalue==c[0]?"selected=\"selected\" ":""}value="${c[0]}">${c[1]||c[0]}</option>`;return`<select ${b}>${e}</select>`;case"checkbox":return`<input type="checkbox" ${a.defaultvalue?"checked=\"checked\"":""} value="1" offvalue="0" ${b} />`;case"textarea":return`<textarea ${b} style="width: 100%" ${a.fieldoptions||""}>${a.defaultvalue||""}</textarea>`;default:case"float":case"text":return`<input type="text" value="${a.defaultvalue||""}" ${b} style="width: 100%" />`;}},inDom:function(){this.search.find("input:last").trigger("change")},lock:function(){this.locked=!0,this.buttonInst&&(this.buttonInst.setTitle(this.module.getConfiguration("buttonlabel_exec","Loading...")||"Loading..."),this.buttonInst.disable())},unlock:function(){this.locked=!1,this.buttonInst&&(this.buttonInst.setTitle(this.module.getConfiguration("buttonlabel","Search")||"Search"),this.buttonInst.enable())},update:{vartrigger:function(a){null==a||this.module.controller.doSearch()},url:function(a){this._url=a.get()}},onActionReceive:{doSearch:function(){this.module.controller.doSearch()},buttonColor:function(a){this.buttonInst&&this.buttonInst.setColor(a)}},showError:function(){this.$feedback.html("Error").css("color","red"),this._feedbackTimeout()},showSuccess:function(a){this.$feedback.html(`Request successful with status ${a}`).css("color","green"),this._feedbackTimeout()},_feedbackTimeout:function(){var a=this;this._ftimeout&&clearTimeout(this._ftimeout),this._ftimeout=setTimeout(function(){a.$feedback.html("")},5e3)}}),d});
